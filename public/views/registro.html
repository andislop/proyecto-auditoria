<!DOCTYPE html>
<html lang="es">
<head>
	<title>Registro de Usuario</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<link rel="stylesheet" href="../css/main.css">
    <!-- Aseguramos que el archivo bootstrap-icons.css se cargue -->
    <!-- ESTE ES EL CSS QUE DABA PROBLEMAS DE MIME TYPE, ASEGÚRATE DE LA RUTA Y DE SERVIRLO CON UN SERVIDOR WEB -->
    <link rel="stylesheet" href="../css/bootstrap-icons.css">
</head>
<body class="cover" style="background-image: url(../assets/img/loginFont.jpg);">
	<form id="registerForm" method="" autocomplete="off" class="full-box logInForm">
		<!-- Icono de usuario de Bootstrap Icons -->
		<p class="text-center text-muted"><i class="bi bi-person-plus-fill bi-5x"></i></p>
		<p class="text-center text-muted text-uppercase">Crea una nueva cuenta</p>
	    <div class="form-group label-floating">
		    <label class="control-label" for="correo">Correo</label>
		    <input class="form-control" id="correo" type="email" required>
		    <p class="help-block">Escribe tu Correo</p>
		</div>
		<div class="form-group label-floating">
		    <label class="control-label" for="contraseña">Contraseña</label>
		    <input class="form-control" id="contraseña" type="password" required>
		    <p class="help-block">Escribe tu contraseña</p>
		</div>
		<div class="form-group text-center">
			<input type="submit" value="Registrarse" class="btn btn-raised btn-login">
		</div>
		<div>
			<p><a href="http://localhost:3000">¿Ya tienes cuenta? Inicia sesión</a></p>
		</div>
	</form>
	<!--====== Scripts -->
	<script src="../js/jquery-3.1.1.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script src="../js/material.min.js"></script>
	<script src="../js/ripples.min.js"></script>
	<script src="../js/sweetalert2.min.js"></script> <!-- AHORA SweetAlert2 ESTÁ BIEN POSICIONADO -->
	<script src="../js/jquery.mCustomScrollbar.concat.min.js"></script>
	<script src="../js/main.js"></script>
	<script>
        // Envuelve todo el JavaScript personalizado dentro de $(document).ready()
        // Esto asegura que el DOM y todas las librerías (incluyendo SweetAlert2) estén cargados
        // antes de que tu código intente interactuar con ellas.
		$(document).ready(function() {
            // Inicializa los componentes de Material Design
            $.material.init();

            // Función para manejar el registro de usuario
            async function handleRegister(event) {
                event.preventDefault(); // Prevenir el envío del formulario por defecto

                const correoInput = document.getElementById('correo').value;
                const contraseñaInput = document.getElementById('contraseña').value;

                // Validación básica de campos
                if (!correoInput || !contraseñaInput) {
                    showCustomAlert("Por favor, completa todos los campos.");
                    return;
                }

                const correo = correoInput.trim();
                const contraseña = contraseñaInput.trim();
                const rol = "Administrador"; // Rol enviado por defecto como "Administrador"

                try {
                    // Realiza la petición POST a tu API de registro
                    // ¡IMPORTANTE!: Cambia 'http://localhost:3001' por la URL de tu backend real
                    const response = await fetch('http://localhost:3000/api/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ correo, contraseña, rol })
                    });

                    const result = await response.json();

                    if (response.ok) { // Si la respuesta HTTP es 200 OK (o 201 Created)
                        Swal.fire({
                            title: "¡Éxito!",
                            text: result.message || "Usuario registrado exitosamente.",
                            icon: "success",
                            confirmButtonText: "Ok"
                        }).then(() => {
                            // Opcional: Redirigir al usuario a la página de login después de un registro exitoso
                            window.location.href = 'index.html'; 
                        });
                    } else {
                        // Error en el registro (ej. correo ya existe, error del servidor)
                        Swal.fire({
                            title: "Error",
                            text: result.error || "Error al registrar usuario. Inténtalo de nuevo.",
                            icon: "error",
                            confirmButtonText: "Ok"
                        });
                    }
                } catch (error) {
                    console.error('Error al conectar con el servidor de registro:', error);
                    Swal.fire({
                        title: "Error de conexión",
                        text: "No se pudo conectar con el servidor. Por favor, inténtalo más tarde.",
                        icon: "error",
                        confirmButtonText: "Ok"
                    });
                }
            }

            // Asigna el manejador de eventos al formulario de registro
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', handleRegister);
            }

            // Función de alerta personalizada que usa SweetAlert2
            function showCustomAlert(message) {
                Swal.fire({
                    title: "Alerta",
                    text: message,
                    icon: "warning",
                    confirmButtonText: "Ok"
                });
            }
        }); // Cierre de $(document).ready()
	</script>
</body>
</html>
